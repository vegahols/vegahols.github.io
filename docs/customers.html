<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Customer Overview</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highcharts/grid-pro/css/grid-pro.css" />
  <style>* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    background-color: white;
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  #container {
    max-width: 1200px;
    margin: 0 auto;
  }
  h1 {
    color: #2c3e50;
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 8px;
  }
  .subtitle {
    color: #7f8c8d;
    font-size: 14px;
    margin-bottom: 20px;
  }
  .controls {
    margin-bottom: 15px;
  }
  .btn {
    padding: 8px 16px;
    background-color: #2c3e50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.2s;
  }
  .btn:hover {
    background-color: #1a252f;
  }
  #grid {
    border: 1px solid #e8ecef;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }</style>
  <script src="https://cdn.jsdelivr.net/npm/@highcharts/grid-pro/grid-pro.js"></script>
</head>
<body>
  <div id="container" class="highcharts-light">
    <h1>Customer Overview</h1>
    <p class="subtitle">Search, sort, and filter customer data</p>
    <div class="controls">
      <button class="btn" onclick="downloadCSV()">Download CSV</button>
    </div>
    <div id="grid"></div>
  </div>

  <script>
    const data = {"Company":["Acme Corp","TechStart Inc","Global Solutions","Innovation Labs","Digital Ventures","Future Systems","Smart Analytics","Data Insights","Cloud Nine","Peak Performance","Next Gen Tech","Prime Solutions","Elite Consulting","Apex Industries","Summit Corp"],"Contact":["John Smith","Sarah Johnson","Mike Chen","Emily Brown","David Lee","Lisa Anderson","Robert Taylor","Maria Garcia","James Wilson","Patricia Martinez","Michael Davis","Jennifer Rodriguez","William Lopez","Elizabeth Lee","Christopher Kim"],"Revenue":["$125,000","$ 89,000","$156,000","$ 67,000","$198,000","$143,000","$ 92,000","$178,000","$134,000","$156,000","$ 98,000","$187,000","$112,000","$165,000","$145,000"],"Region":["North","East","West","South","North","East","West","South","North","East","West","South","North","East","West"],"Status":["Active","Active","Active","Pending","Active","Active","Pending","Active","Active","Active","Pending","Active","Active","Active","Pending"]};

    const grid = Grid.grid("grid", {
      dataTable: {
        columns: data
      },
      columnDefaults: {"filtering":{"enabled":true}},
      columns: [{"id":"Company"},{"id":"Contact"},{"id":"Revenue"},{"id":"Region"},{"id": "Status", "cells": { "formatter": function(cell) {
        const value = cell.value;
        const color = value === "Active" ? "#5CB85C" : "#F0AD4E";
        const bgColor = value === "Active" ? "#E8F5E9" : "#FFF3E0";
        return `<span style="background-color: ${bgColor}; color: ${color}; padding: 4px 12px; border-radius: 12px; font-weight: 500; font-size: 12px;">${value}</span>`;
      } }}],
      pagination: {"enabled":true,"pageSize":10,"controls":{"pageSizeSelector":{"enabled":true,"options":[5,10,25,50]},"pageInfo":true,"firstLastButtons":true,"previousNextButtons":true,"pageButtons":{"enabled":true,"count":7}}},
      credits: {"enabled":false},
      exporting: {"enabled":true}
    });

    function downloadCSV() {
    if (grid && grid.dataTable) {
      // Get all columns from dataTable
      const columns = grid.dataTable.getColumns();
      const columnNames = Object.keys(columns);

      // Build CSV manually to ensure all rows are included
      let csv = columnNames.join(",") + "\n";

      // Get the row count from the first column
      const rowCount = columns[columnNames[0]].length;

      // Build each row
      for (let i = 0; i < rowCount; i++) {
        const row = columnNames.map(colName => {
          let value = columns[colName][i];
          // Handle null/undefined
          if (value === null || value === undefined) {
            value = "";
          }
          // Escape and quote if necessary
          value = String(value);
          if (value.includes(",") || value.includes("\"") || value.includes("\n")) {
            value = "\"" + value.replace(/"/g, "\"\"") + "\"";
          }
          return value;
        });
        csv += row.join(",") + "\n";
      }

      // Create blob and download
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "customers.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }
  }
  </script>
</body>
</html>
